<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Emotional Support Bot - Xiao Y</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #1e88e5, #1976d2);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }

    .chat-container {
      width: 100%;
      max-width: 500px;
      height: 90vh;
      background-color: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .chat-header {
      background: linear-gradient(135deg, #1e88e5, #1976d2);
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 1.4rem;
      font-weight: 600;
      position: relative;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      border-bottom: 2px solid rgba(255, 255, 255, 0.2);
    }

    .header-icon {
      font-size: 2rem;
      margin-right: 10px;
      vertical-align: middle;
    }

    .chat-messages {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      background: rgba(235, 245, 255, 0.7);
      display: flex;
      flex-direction: column;
    }

    .welcome-message {
      text-align: center;
      margin-bottom: 20px;
      color: #0d47a1;
      font-size: 1rem;
      line-height: 1.6;
      background: rgba(255, 255, 255, 0.9);
      padding: 15px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(25, 118, 210, 0.2);
    }

    .message {
      max-width: 85%;
      padding: 15px 20px;
      margin-bottom: 15px;
      border-radius: 20px;
      line-height: 1.5;
      position: relative;
      animation: fadeIn 0.4s ease;
      font-size: 1.1rem;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s, box-shadow 0.3s;
      overflow-wrap: break-word;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .user-message {
      background: linear-gradient(135deg, #1e88e5, #1976d2);
      color: white;
      margin-left: auto;
      border-bottom-right-radius: 5px;
      box-shadow: 0 4px 10px rgba(30, 136, 229, 0.3);
      transform-origin: right;
      text-align: right;
    }

    .bot-message {
      background: linear-gradient(135deg, #ffffff, #f8f9fa);
      color: #333;
      margin-right: auto;
      border-bottom-left-radius: 5px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      transform-origin: left;
      text-align: left;
    }

    .message:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
    }

    .typing-indicator {
      display: none;
      padding: 15px 20px;
      background: #f8f9fa;
      color: #333;
      border-radius: 20æç®€;
      margin-bottom: 15px;
      width: fit-content;
      border-bottom-left-radius: 5px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      font-size: 1.1rem;
    }

    .emotion-tag {
      font-size: 0.85rem;
      color: #1976d2;
      margin-top: 8px;
      font-weight: 500;
      text-align: left;
      display: flex;
      align-items: center;
      padding: 8px 15px;
      background: rgba(30, 136, 229, 0.1);
      border-radius: 15px;
      margin-left: auto;
      margin-right: auto;
      width: fit-content;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    .chat-input-container {
      display: flex;
      padding: 15px 20px;
      background: white;
      border-top: 1px solid rgba(0, 0, 0, 0.1);
    }

    .chat-input-group {
      flex: 1;
      display: flex;
    }

    .chat-tools {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      margin-left: 10px;
      background: rgba(30, 136, 229, 0.05);
      padding: 8px 15px;
      border-radius: 25px;
    }

    .quick-emoji-btn {
      font-size: 1.4rem;
      background: none;
      border: none;
      cursor: pointer;
      margin: 0 5px;
      padding: 8px;
      border-radius: 50%;
      transition: all 0.3s;
    }

    .quick-emoji-btn:hover {
      background: rgba(30, 136, 229, 0.15);
      transform: scale(1.15);
    }

    #message-input {
      flex: 1;
      padding: 15px 20px;
      border: 2px solid #bbdefb;
      border-radius: 30px;
      outline: none;
      font-size: 1.1rem;
      transition: all 0.3s;
      background: rgba(255, 255, 255, 0.9);
    }

    #message-input:focus {
      border-color: #1976d2;
      box-shadow: 0 0 0 4px rgba(25, 118, 210, 0.2);
      background: white;
    }

    #send-button {
      background: linear-gradient(135deg, #1e88e5, #1976d2);
      color: white;
      border: none;
      border-radius: 30px;
      padding: 15px 30px;
      margin-left: 15px;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      transition: transform 0.2s, opacity 0.2s;
      box-shadow: 0 4px 15px rgba(30, 136, 229, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    #send-button:hover {
      opacity: 0.9;
      transform: scale(0.98);
    }

    #send-button:active {
      transform: scale(0.95);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(15px) scale(0.9);
      }

      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    @keyframes floatIcon {
      0% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-5px);
      }

      100% {
        transform: translateY(0);
      }
    }

    .emoji-popup {
      display: none;
      position: absolute;
      bottom: 80px;
      right: 20px;
      background: white;
      border-radius: 15px;
      padding: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      z-index: 100;
      width: 300px;
      max-height: 250px;
      overflow-y: auto;
      border: 1px solid #eee;
    }

    .emoji-panel {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 12px;
    }

    .emoji-item {
      font-size: 1.8rem;
      text-align: center;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: background 0.2s, transform 0.2s;
    }

    .emoji-item:hover {
      background: #e3f2fd;
      transform: scale(1.2);
    }

    .emoji-toggle {
      position: absolute;
      right: 20px;
      bottom: 85px;
      background: white;
      border: none;
      border-radius: 50%;
      width: 45px;
      height: 45px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      font-size: 1.5rem;
      color: #1e88e5;
      transition: all 0.3s;
    }

    .emoji-toggle:hover {
      background: #e3f2fd;
      transform: scale(1.1);
    }

    .typing-dots {
      display: inline-flex;
      margin-left: 10px;
    }

    .typing-dots span {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: #1e88e5;
      margin: 0 2px;
      opacity: 0.4;
      animation: dotPulse 1.5s infinite ease-in-out;
    }

    .typing-dots span:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-dots span:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes dotPulse {

      0%,
      100% {
        transform: scale(0.8);
        opacity: 0.4;
      }

      50% {
        transform: scale(1.2);
        opacity: 0.8;
      }
    }

    .quick-emojis-container {
      padding: 10px 0;
      background: rgba(255, 255, 255, 0.8);
      border-bottom: 1px solid #e3f2fd;
      position: relative;
      z-index: 10;
    }

    .quick-emojis-label {
      display: flex;
      justify-content: center;
      margin-bottom: 10px;
      color: #1565c0;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .emoji-send-desc {
      font-size: 0.8rem;
      color: #757575;
      text-align: center;
      margin-top: 10px;
    }

    .emoji-status {
      position: absolute;
      top: 15px;
      left: 20px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      color: white;
      font-size: 1.8rem;
    }

    @media (max-width: 600px) {
      .chat-container {
        height: 95vh;
        max-width: 100%;
        border-radius: 15px;
      }

      .message {
        max-width: 90%;
        padding: 12px 16px;
        font-size: 1rem;
      }

      #send-button {
        padding: 12px 25px;
      }

      #message-input {
        padding: 12px 18px;
      }

      .emoji-panel {
        grid-template-columns: repeat(6, 1fr);
      }

      .quick-emoji-btn {
        font-size: 1.1rem;
        padding: 6px;
      }
    }
  </style>
</head>

<body>
  <div class="chat-container">
    <div class="chat-header">
      <div class="emoji-status">ğŸ˜Š</div>
      <i class="fas fa-robot header-icon"></i>
      Emotional Support Bot (Emoji Enhanced)
    </div>

    <div class="quick-emojis-container">
      <div class="quick-emojis-label">Quick Send Emotions</div>
      <div class="chat-tools">
        <button class="quick-emoji-btn" data-emoji="ğŸ˜Š">ğŸ˜Š</button>
        <button class="quick-emoji-btn" data-emoji="ğŸ˜¢">ğŸ˜¢</button>
        <button class="quick-emoji-btn" data-emoji="ğŸ˜ ">ğŸ˜ </button>
        <button class="quick-emoji-btn" data-emoji="â¤ï¸">â¤ï¸</button>
        <button class="quick-emoji-btn" data-emoji="ğŸ˜¨">ğŸ˜¨</button>
        <button class="quick-emoji-btn" data-emoji="ğŸ˜²">ğŸ˜²</button>
        <button class="quick-emoji-btn" data-emoji="ğŸ¤—">ğŸ¤—</button>
      </div>
    </div>

    <div class="chat-messages" id="chat-messages">
      <div class="welcome-message">
        <div style="margin-bottom: 15px;">
          <i class="fas fa-smile-beam" style="font-size: 2rem; color: #1976d2; margin-bottom: 10px;"></i>
          <h3 style="color: #0d47a1; margin-bottom: 10px;">Hello! I'm Xiao Y, your emotional support companion</h3>
          <p>I'm here to listen and support you with advanced emoji recognition.<br>Express your feelings with text or
            emojis - I'll understand!</p>
        </div>
        <div style="border-top: 1px dashed #90caf9; padding-top: 15px; margin-top: 10px; font-size: 0.9rem;">
          <p><strong>Tip:</strong> Click on the quick emoji buttons above to send emotions instantly, or use the ğŸ˜€
            button for more emojis!</p>
        </div>
      </div>
    </div>

    <div class="chat-input-container">
      <div class="chat-input-group">
        <input type="text" id="message-input" placeholder="Express yourself with words or emojis..." autocomplete="off">
        <button class="emoji-toggle" id="emoji-toggle">ğŸ˜€</button>
        <div class="emoji-popup" id="emoji-popup">
          <div class="emoji-panel" id="emoji-panel">
            ğŸ˜  ğŸ˜¡ ğŸ’¢ ğŸ˜¤ ğŸ¤¬ ğŸ˜ƒ ğŸ˜„ ğŸ˜ ğŸ¥³ ğŸ¤© ğŸ˜‚ ğŸ˜… ğŸ˜‡ ğŸ¤£ ğŸ™‚ ğŸ˜‰ ğŸ˜Š
            ğŸ¥° ğŸ˜˜ ğŸ˜ â¤ï¸ ğŸ’• ğŸ’˜ ğŸ’– ğŸ’— ğŸ’“ ğŸ’ ğŸ¤— ğŸ˜¢ ğŸ˜­ ğŸ˜¿ ğŸ˜“ ğŸ˜ ğŸ˜”
            ğŸ¥º ğŸ˜¥ ğŸ˜° ğŸ˜¨ ğŸ˜§ ğŸ˜¬ ğŸ˜± ğŸ‘» ğŸ˜² ğŸ˜¯ ğŸ¤¯ ğŸ¤” ğŸ˜ ğŸ˜‘ ğŸ™„ ğŸ§
          </div>
          <p class="emoji-send-desc">Click any emoji to add to your message</p>
        </div>
      </div>
      <button id="send-button">
        <i class="far fa-paper-plane"></i>
        Send
      </button>
    </div>
  </div>

  <script>
    // è·å–DOMå…ƒç´ 
    const messageInput = document.getElementById('message-input');
    const sendButton = document.getElementById('send-button');
    const chatMessages = document.getElementById('chat-messages');
    const emojiToggle = document.getElementById('emoji-toggle');
    const emojiPopup = document.getElementById('emoji-popup');
    const emojiPanel = document.getElementById('emoji-panel');
    const quickEmojiBtns = document.querySelectorAll('.quick-emoji-btn');
    const emojiStatus = document.querySelector('.emoji-status');
    const chatHeader = document.querySelector('.chat-header');

    // åˆ›å»ºè¡¨æƒ…å…ƒç´ 
    const emojis = emojiPanel.textContent.split(' ').filter(e => e.trim() !== '');
    emojiPanel.innerHTML = '';
    emojis.forEach(emoji => {
      const emojiElement = document.createElement('div');
      emojiElement.className = 'emoji-item';
      emojiElement.textContent = emoji;
      emojiElement.addEventListener('click', () => {
        // æ·»åŠ åˆ°è¾“å…¥æ¡†
        messageInput.value += emoji;
        messageInput.focus();

        // æ·»åŠ è§†è§‰åé¦ˆ
        emojiElement.style.backgroundColor = '#e3f2fd';
        setTimeout(() => {
          emojiElement.style.backgroundColor = '';
        }, 300);

        // æ›´æ–°è¡¨æƒ…çŠ¶æ€
        updateEmojiStatus(emoji);
      });
      emojiPanel.appendChild(emojiElement);
    });

    // å¿«é€Ÿå‘é€è¡¨æƒ…æŒ‰é’®äº‹ä»¶
    quickEmojiBtns.forEach(btn => {
      btn.addEventListener('click', (e) => {
        const emoji = btn.dataset.emoji;

        // ç›´æ¥å‘é€è¡¨æƒ…ï¼Œä¸ç»è¿‡è¾“å…¥æ¡†
        sendEmojiDirectly(emoji);

        // æ·»åŠ ç‚¹å‡»åŠ¨ç”»
        btn.animate([
          { transform: 'scale(1)' },
          { transform: 'scale(1.5)' },
          { transform: 'scale(1)' }
        ], {
          duration: 400
        });

        // æ›´æ–°è¡¨æƒ…çŠ¶æ€
        updateEmojiStatus(emoji);
      });
    });

    // æ›´æ–°æ ‡é¢˜çŠ¶æ€è¡¨æƒ…
    function updateEmojiStatus(emoji) {
      emojiStatus.textContent = emoji;
      emojiStatus.animate([
        { transform: 'scale(1)' },
        { transform: 'scale(1.4)' },
        { transform: 'scale(1)' }
      ], {
        duration: 500
      });

      // ä¸´æ—¶æ”¹å˜å¤´éƒ¨é¢œè‰²
      const emotionColors = {
        'ğŸ˜Š': '#4caf50',
        'ğŸ˜¢': '#5c6bc0',
        'ğŸ˜ ': '#f44336',
        'â¤ï¸': '#e91e63',
        'ğŸ˜¨': '#795548',
        'ğŸ˜²': '#ff9800',
        'ğŸ¤—': '#3f51b5'
      };

      if (emotionColors[emoji]) {
        const origBg = chatHeader.style.background;
        chatHeader.style.background = emotionColors[emoji];
        setTimeout(() => {
          chatHeader.style.background = origBg;
        }, 2000);
      }
    }

    // ç›´æ¥å‘é€è¡¨æƒ…è€Œä¸ç»è¿‡è¾“å…¥æ¡†
    function sendEmojiDirectly(emoji) {
      // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°èŠå¤©åŒºåŸŸ
      addMessage(`${emoji}`, true);

      // æ˜¾ç¤º"æœºå™¨äººæ­£åœ¨è¾“å…¥"çŠ¶æ€
      showTypingIndicator();

      // åˆ›å»ºæ¨¡æ‹Ÿäº‹ä»¶ï¼Œè®©è¡¨æƒ…åˆ†ææ›´å‡†ç¡®
      setTimeout(() => {
        // æœºå™¨äººåˆ†æå¹¶å›åº”
        const emotionResponses = {
          'ğŸ˜Š': "ğŸ˜„ It's wonderful to see you happy! What's making you smile today?",
          'ğŸ˜¢': "ğŸ¤— I sense you're feeling down. Would you like to share what's troubling you?",
          'ğŸ˜ ': "ğŸ§˜â€â™€ï¸ I feel your anger. What's causing this frustration? I'm here to listen.",
          'â¤ï¸': "ğŸ’– Love is a beautiful emotion. Would you like to share more about this feeling?",
          'ğŸ˜¨': "ğŸ›¡ï¸ Fear can be overwhelming. What concerns you right now?",
          'ğŸ˜²': "ğŸ¤¯ Wow, what a surprise! What happened?",
          'ğŸ¤—': "ğŸ’• Hugs sent your way! How are you feeling today?"
        };

        // éšè—æ‰“å­—æŒ‡ç¤ºå™¨
        hideTypingIndicator();

        // æ·»åŠ æœºå™¨äººå›å¤
        const response = emotionResponses[emoji] || "ğŸ¤” I see you're feeling something. Would you like to share more?";
        addMessage(`ğŸ¤– ${response}`, false);

        // æ˜¾ç¤ºæƒ…æ„Ÿæ ‡ç­¾
        const emotionMap = {
          'ğŸ˜Š': 'joy',
          'ğŸ˜¢': 'sadness',
          'ğŸ˜ ': 'anger',
          'â¤ï¸': 'love',
          'ğŸ˜¨': 'fear',
          'ğŸ˜²': 'surprise',
          'ğŸ¤—': 'support'
        };

        if (emotionMap[emoji]) {
          showEmotionTag(emotionMap[emoji], emoji);
        }
      }, 1000 + Math.random() * 1000);
    }

    // åˆ‡æ¢è¡¨æƒ…é¢æ¿æ˜¾ç¤º
    emojiToggle.addEventListener('click', (e) => {
      e.stopPropagation();
      emojiPopup.style.display = emojiPopup.style.display === 'block' ? 'none' : 'block';
    });

    // åˆ›å»ºæ‰“å­—æŒ‡ç¤ºå™¨
    const typingIndicator = document.createElement('div');
    typingIndicator.className = 'typing-indicator';
    typingIndicator.innerHTML = '<i class="fas fa-robot" style="margin-right: 10px; color: #1e88e5;"></i> Xiao Y is analyzing your emotions... <div class="typing-dots"><span></span><span></span><span></span></div>';

    // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©åŒºåŸŸ
    function addMessage(text, isUser) {
      const messageElement = document.createElement('div');
      messageElement.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
      messageElement.innerHTML = text;
      chatMessages.appendChild(messageElement);

      // æ»šåŠ¨åˆ°åº•éƒ¨
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // æ˜¾ç¤ºæ‰“å­—æŒ‡ç¤ºå™¨
    function showTypingIndicator() {
      typingIndicator.style.display = 'flex';
      chatMessages.appendChild(typingIndicator);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // éšè—æ‰“å­—æŒ‡ç¤ºå™¨
    function hideTypingIndicator() {
      typingIndicator.style.display = 'none';
    }

    // æ˜¾ç¤ºæƒ…æ„Ÿæ ‡ç­¾
    function showEmotionTag(emotion, emojis) {
      const emotionTag = document.createElement('div');
      emotionTag.className = 'emotion-tag';

      // æ·»åŠ è¡¨æƒ…å›¾æ ‡
      const emotionEmojis = {
        'anger': 'ğŸ˜ ',
        'joy': 'ğŸ˜„',
        'sadness': 'ğŸ˜¢',
        'fear': 'ğŸ˜¨',
        'love': 'â¤ï¸',
        'surprise': 'ğŸ˜²',
        'support': 'ğŸ¤—',
        'neutral': 'ğŸ¤”'
      };

      const emoji = emotionEmojis[emotion] || 'ğŸ¤–';

      let emojiText = "";
      if (emojis) {
        emojiText = ` | Sent emoji: ${emojis}`;
      }

      emotionTag.innerHTML = `<span style="font-size: 1.2rem; margin-right: 10px;">${emoji}</span> Detected emotion: ${emotion}${emojiText}`;
      chatMessages.appendChild(emotionTag);
      chatMessages.scrollTop = chatMessages.scrollHeight;

      // æ·»åŠ åŠ¨ç”»æ•ˆæœ
      emotionTag.animate([
        { transform: 'translateY(-10px)', opacity: 0 },
        { transform: 'translateY(0)', opacity: 1 }
      ], {
        duration: 500,
        easing: 'ease-out'
      });
    }

    // å‘é€æ¶ˆæ¯åˆ°åç«¯
    async function sendMessage() {
      const message = messageInput.value.trim();
      if (!message) return;

      // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°èŠå¤©åŒºåŸŸ
      addMessage(`${message}`, true);
      messageInput.value = '';
      messageInput.focus();

      // å…³é—­è¡¨æƒ…é¢æ¿
      emojiPopup.style.display = 'none';

      // æ˜¾ç¤º"æœºå™¨äººæ­£åœ¨è¾“å…¥"çŠ¶æ€
      showTypingIndicator();

      try {
        // å‘é€POSTè¯·æ±‚åˆ°åç«¯
        const response = await fetch('/chat', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ message: message }),
        });

        // æ£€æŸ¥ç½‘ç»œå“åº”æ˜¯å¦æ­£å¸¸
        if (!response.ok) {
          throw new Error(`Server responded with status ${response.status}`);
        }

        // è§£æJSONå“åº”
        const data = await response.json();

        // éšè—æ‰“å­—æŒ‡ç¤ºå™¨
        hideTypingIndicator();

        // æ£€æŸ¥æ˜¯å¦ä¸ºç»“æŸå¯¹è¯
        if (data.end_conversation) {
          addMessage(`ğŸ¤– ${data.response}`, false);
          messageInput.disabled = true;
          sendButton.disabled = true;
          emojiToggle.style.display = 'none';
        } else {
          // æ·»åŠ æœºå™¨äººå›å¤
          addMessage(`ğŸ¤– ${data.response}`, false);

          // æ˜¾ç¤ºæƒ…æ„Ÿæ ‡ç­¾
          if (data.emotion) {
            showEmotionTag(data.emotion, data.emojis);
          }
        }
      } catch (error) {
        // å¤„ç†é”™è¯¯æƒ…å†µ
        hideTypingIndicator();
        console.error('Error:', error);

        // æ·»åŠ é”™è¯¯æ¶ˆæ¯
        const errorElement = document.createElement('div');
        errorElement.className = 'bot-message';
        errorElement.innerHTML = `âš ï¸ Sorry, I encountered a problem. Could you try again?`;
        chatMessages.appendChild(errorElement);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
    }

    // ç»‘å®šå‘é€æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    sendButton.addEventListener('click', sendMessage);

    // ç»‘å®šè¾“å…¥æ¡†å›è½¦é”®äº‹ä»¶
    messageInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // ç‚¹å‡»èŠå¤©å†…å®¹åŒºåŸŸå…³é—­è¡¨æƒ…é¢æ¿
    chatMessages.addEventListener('click', () => {
      emojiPopup.style.display = 'none';
    });

    // æ–‡æ¡£ç‚¹å‡»å…³é—­è¡¨æƒ…é¢æ¿
    document.addEventListener('click', (e) => {
      if (!emojiPopup.contains(e.target) && e.target !== emojiToggle) {
        emojiPopup.style.display = 'none';
      }
    });

    // é¡µé¢åŠ è½½åè‡ªåŠ¨èšç„¦åˆ°è¾“å…¥æ¡†
    window.addEventListener('DOMContentLoaded', () => {
      messageInput.focus();
    });

    // æ·»åŠ æœºå™¨äººæµ®åŠ¨åŠ¨ç”»
    const robotIcon = document.querySelector('.fa-robot');
    if (robotIcon) {
      setInterval(() => {
        robotIcon.animate([
          { transform: 'translateY(0)' },
          { transform: 'translateY(-5px)' },
          { transform: 'translateY(0)' }
        ], {
          duration: 2000,
          iterations: Infinity
        });
      }, 5000);
    }
  </script>
</body>

</html>